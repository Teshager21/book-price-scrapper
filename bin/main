#!/usr/bin/env ruby
require_relative '../lib/page_parser'
require_relative '../lib/data_filter'
system('clear')
puts " \n             CHOOSE THE CATEGOTY OF YOUR INTEREST(use the shortcut letters in the brackets)\n" \
     "\n                Books(b)       |   Laptops(l)          |   Games(g)   |   Clothing(c)\n" \
     "\n                Car Parts(cp)  |   Classical Music(m)  |   Bags(bg)   |   Beautiy(bt)\n\n" \
     "Select what you want to scrap:\n\n"
selection = gets.chomp.downcase

url_matcher = { 'b' => 'https://www.amazon.com/Best-Sellers-Books-Deals/zgbs/books/45/ref=zg_bs_pg_1?_encoding=UTF8&pg=',
                'bg' => 'https://www.amazon.com/Best-Sellers-Computers-Accessories-Laptop-Messenger-'\
 'Shoulder-Bags/zgbs/pc/3012921011/ref=zg_bs_pg_1?_encoding=UTF8&pg=',
                'l' => 'https://www.amazon.co.uk/gp/most-wished-for/computers/429886031/ref=zg_mw_pg_2/261-4675934-0829812?ie=UTF8&pg=',
                'c' => 'https://www.amazon.co.uk/gp/most-wished-for/clothing/ref=zg_mw_pg_2?ie=UTF8&pg=',
                'cp' => 'https://www.amazon.co.uk/gp/new-releases/automotive/ref=zg_bsnr_pg_2?ie=UTF8&pg=',
                'm' => 'https://www.amazon.co.uk/Best-Sellers-Music-Symphonies-Orchestras/zgbs/music/505594/ref=zg_bs_pg_2?_encoding=UTF8&pg=',
                'g' => 'https://www.amazon.co.uk/Best-Sellers-PC-Video-Games-PlayStation-Consoles-Accessories/'\
 'zgbs/videogames/13978348031/ref=zg_bs_pg_2?_encoding=UTF8&pg=',
                'bt' => 'https://www.amazon.co.uk/gp/most-wished-for/beauty/ref=zg_mw_pg_2?ie=UTF8&pg=' }

(1..999).each do |i|
  i = i.to_s
  begin
    url = url_matcher[selection] + i
  rescue StandardError
    puts 'Wrong Input'
    exit
  end

  page_parser = PageParser.new(url)

  data_filter = DataFilter.new(page_parser.parse_page)
  data_filter.item_cards
  break if data_filter.item_cards.count.zero?

  puts data_filter.product_page(selection)
  puts "\n   LOADING THE NEXT PAGE ..." + "\n   PRESS e TO STOP SCRAPPING OR ANYOTHER CHARACTER TO CONTINUE"
  option = gets.chomp
  break if option.downcase == 'e'
end
