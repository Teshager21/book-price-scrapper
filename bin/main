#!/usr/bin/env ruby
require_relative '../lib/page_parser'
require_relative '../lib/data_filter'
system('clear')
puts " CHOOSE THE CATEGOTY OF YOUR INTEREST(use the shortcut letters in the brackets)\n"
puts "\n  Books(b)       |   Laptops(l)          |  Bags(bg)  |  Clothing(c)\n"
puts "\n  Car Parts(cr)  |   Classical Music(m)  |  Bags(bg)  |  Clothing(c)\n\n"
puts 'Select what you want to scrap:'
selection = gets.chomp.downcase

(1..1000).each do |i|
  case selection
  when 'b'
    url = 'https://www.amazon.com/Best-Sellers-Books-Deals/zgbs/books/45/ref=zg_bs_pg_1?_encoding=UTF8&pg=' + i.to_s
  when 'bg'
    url = 'https://www.amazon.com/Best-Sellers-Computers-Accessories-Laptop-Messenger-'\
    'Shoulder-Bags/zgbs/pc/3012921011/ref=zg_bs_pg_1?_encoding=UTF8&pg=' + i.to_s
  when 'l'
    url = 'https://www.amazon.co.uk/gp/most-wished-for/computers/429886031/ref=zg_mw_pg_2/'
    +'261-4675934-0829812?ie=UTF8&pg=' + i.to_s
  when 'c'
    url = 'https://www.amazon.co.uk/gp/most-wished-for/clothing/ref=zg_mw_pg_2?ie=UTF8&pg=' + i.to_s
  when 'cr'
    url = 'https://www.amazon.co.uk/gp/new-releases/automotive/ref=zg_bsnr_pg_2?ie=UTF8&pg=' + i.to_s
  when 'm'
    url = 'https://www.amazon.co.uk/Best-Sellers-Music-Symphonies-Orchestras/zgbs/music/505594/'
    +'ref=zg_bs_pg_2?_encoding=UTF8&pg=' + i.to_s
  else puts 'wrong input'
  end
  page_parser = PageParser.new(url)

  page_parser.bring_unparsed_page
  page_parser.parse_page

  data_filter = DataFilter.new(page_parser.parsed_page)
  data_filter.category = selection
  data_filter.item_cards
  break if data_filter.item_cards.count.zero?

  data_filter.product_page
  puts 'LOADING THE NEXT PAGE ...'
  puts 'PRESS e TO STOP SCRAPPING'
  option = gets.chomp
  break if option.downcase == 'e'
end
